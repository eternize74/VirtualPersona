# Phase 3 êµ¬í˜„ ê³„íš: Neural Avatar

## ê°œìš”

Phase 2 ê³ ë„í™”ê°€ ì™„ë£Œëœ ìƒíƒœì—ì„œ Phase 3 Neural Avatar ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤. Phase 1/2ì™€ Phase 3ëŠ” ë¶„ë¦¬í•˜ì—¬ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•©ë‹ˆë‹¤.

---

## Phase 2 í˜„ì¬ ìƒíƒœ (âœ… ì™„ë£Œ)

| ê¸°ëŠ¥ | íŒŒì¼ | ìƒíƒœ |
|------|------|------|
| ì–¼êµ´ ì¶”ì  (MediaPipe) | `useFaceTracking.ts` | âœ… |
| 2D ì•„ë°”íƒ€ ë Œë”ë§ | `AvatarRenderer.tsx` | âœ… |
| í™•ì¥ ë Œë”ëŸ¬ | `AvatarRendererV2.tsx` | âœ… |
| ì•„ë°”íƒ€ ì»¤ìŠ¤í„°ë§ˆì´ì§• | `AvatarCustomizer.tsx` | âœ… |
| ê°ì • í”„ë¦¬ì…‹ (6ì¢…) | `EmotionPresets.tsx` | âœ… |
| ì† ì¶”ì  (MediaPipe GestureRecognizer) | `useHandTracking.ts` | âœ… |
| ì œìŠ¤ì²˜ ì¸ì‹ ë° ì „ì†¡ (7ì¢…) | `useWebRTC.ts` | âœ… |
| WebRTC P2P ì—°ê²° | `useWebRTC.ts` | âœ… |
| ì‹œê·¸ë„ë§ ì„œë²„ | `signaling-server.js` | âœ… |

---

## Phase 3 êµ¬í˜„ ë²”ìœ„

README.md ë¡œë“œë§µ ê¸°ì¤€:
1. **GPU ì„ íƒ ëª¨ë“œ** (WebGPU í™œì„±í™”/ë¹„í™œì„±í™”)
2. **PersonaLive / LivePortrait ê³„ì—´ í†µí•©** (Neural Avatar ë Œë”ë§)
3. **ì„±ëŠ¥ fallback êµ¬ì¡°** (GPU ë¯¸ì§€ì› ì‹œ 2D ì•„ë°”íƒ€ë¡œ í´ë°±)

---

## ğŸ”¬ PersonaLive vs LivePortrait ë¹„êµ ë¶„ì„

### ê°œìš”

| í•­ëª© | PersonaLive | LivePortrait |
|------|-------------|--------------|
| **ê°œë°œì‚¬** | GVCLab (Great Bay University) | Kling Team (Kuaishou) |
| **ê³µê°œì¼** | 2024ë…„ 12ì›” | 2024ë…„ 7ì›” |
| **ì•„í‚¤í…ì²˜** | Diffusion ê¸°ë°˜ | Implicit Keypoint ê¸°ë°˜ |
| **ë¼ì´ì„ ìŠ¤** | Apache-2.0 | BSD-3-Clause |
| **GitHub Stars** | ~2.5K | ~35K+ |

### ì•„í‚¤í…ì²˜ ë¹„êµ

#### PersonaLive (Diffusion ê¸°ë°˜)
- **í•µì‹¬ ê¸°ìˆ **: Hybrid Implicit Signals + Streamable Diffusion
- **êµ¬ì„± ìš”ì†Œ**:
  - Denoising UNet
  - Reference UNet
  - Motion Encoder/Extractor
  - Pose Guider
  - Temporal Module
- **íŠ¹ì§•**: ë¬´í•œ ê¸¸ì´ ì• ë‹ˆë©”ì´ì…˜ ìƒì„±, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ìµœì í™”
- **ëª¨ë¸ í¬ê¸°**: ~ìˆ˜ GB (ONNX + ê°€ì¤‘ì¹˜)

#### LivePortrait (Implicit Keypoint ê¸°ë°˜)
- **í•µì‹¬ ê¸°ìˆ **: Implicit Keypoint + Stitching/Retargeting Modules
- **êµ¬ì„± ìš”ì†Œ**:
  - Appearance Feature Extractor
  - Motion Extractor
  - Warping Network
  - Spade Decoder
- **íŠ¹ì§•**: í‘œì • ì„¸ë¶€ ì œì–´ ê°€ëŠ¥, íš¨ìœ¨ì  ì¶”ë¡ 
- **ëª¨ë¸ í¬ê¸°**: ~4GB ONNX

### ì„±ëŠ¥ ë¹„êµ

| í•­ëª© | PersonaLive | LivePortrait |
|------|-------------|--------------|
| **ì¶”ë¡  ì†ë„** | 7-22x ê¸°ì¡´ Diffusion ëŒ€ë¹„ ê°œì„  | **12.8ms/frame (RTX 4090)** |
| **ìµœì†Œ GPU ë©”ëª¨ë¦¬** | 12GB | **4GB** |
| **ìµœì  GPU** | H100 (ê¶Œì¥) | RTX 3060+ |
| **TensorRT ìµœì í™”** | ì§€ì› (2x ì†ë„ í–¥ìƒ) | ì§€ì› (30+ FPS ë‹¬ì„±) |
| **ONNX ì§€ì›** | âœ… ì§€ì› | âœ… ì§€ì› |

### í’ˆì§ˆ ë¹„êµ

| í•­ëª© | PersonaLive | LivePortrait |
|------|-------------|--------------|
| **ì˜ìƒ í’ˆì§ˆ** | â­â­â­â­â­ (ìµœìƒ) | â­â­â­â­ (ìš°ìˆ˜) |
| **í‘œì • í‘œí˜„** | ë§¤ìš° ìì—°ìŠ¤ëŸ¬ì›€ | ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥ |
| **ì… ëª¨ì–‘ ë™ê¸°í™”** | ìš°ìˆ˜ | ì–‘í˜¸ |
| **ëˆˆ/ëˆˆì¹ ì›€ì§ì„** | ìì—°ìŠ¤ëŸ¬ì›€ | ê°„í—ì  ì§€í„° ë³´ê³  |
| **ì¥ì‹œê°„ ì•ˆì •ì„±** | ë¬´í•œ ê¸¸ì´ ì§€ì› | ì•ˆì •ì  |

### ë¸Œë¼ìš°ì € ì ìš© ê°€ëŠ¥ì„± ë¶„ì„

> [!CAUTION]
> **í•µì‹¬ ê²°ë¡ : í˜„ì¬ ê¸°ìˆ ë¡œ ë¸Œë¼ìš°ì € ì™„ì „ ì‹¤í–‰ì€ ë¶ˆê°€ëŠ¥**
> 
> ë‘ ëª¨ë¸ ëª¨ë‘ ë¸Œë¼ìš°ì €ì—ì„œ ì™„ì „í•œ ì‹¤ì‹œê°„ ì‹¤í–‰ì€ **í˜„ì¬ ê¸°ìˆ ì  í•œê³„**ê°€ ìˆìŠµë‹ˆë‹¤.

#### PersonaLive ë¸Œë¼ìš°ì € ì ìš©
| ìš”ì†Œ | í˜„ì‹¤ì„± | ë¹„ê³  |
|------|--------|------|
| ONNX ë³€í™˜ | âš ï¸ ë¶€ë¶„ ê°€ëŠ¥ | UNet ì»´í¬ë„ŒíŠ¸ë§Œ ONNX ì§€ì› |
| WebGPU ì¶”ë¡  | âŒ ë¹„í˜„ì‹¤ì  | Diffusion ëª¨ë¸ í¬ê¸°/ë³µì¡ë„ ê³¼ë‹¤ |
| ëª¨ë¸ ë‹¤ìš´ë¡œë“œ | âŒ ë¹„í˜„ì‹¤ì  | ìˆ˜ GB ëª¨ë¸ ë¸Œë¼ìš°ì € ë¡œë”© ë¶ˆê°€ |
| ì‹¤ì‹œê°„ ì„±ëŠ¥ | âŒ ë¶ˆê°€ | H100ì—ì„œë„ ì‹¤ì‹œê°„ ìœ ì§€ ì–´ë ¤ì›€ |

#### LivePortrait ë¸Œë¼ìš°ì € ì ìš©
| ìš”ì†Œ | í˜„ì‹¤ì„± | ë¹„ê³  |
|------|--------|------|
| ONNX ë³€í™˜ | âœ… ê°€ëŠ¥ | ê³µì‹ ONNX ì§€ì› |
| WebGPU ì¶”ë¡  | âš ï¸ ì‹¤í—˜ì  | ìµœì í™” í•„ìš”, 5-10 FPS ì˜ˆìƒ |
| ëª¨ë¸ ë‹¤ìš´ë¡œë“œ | âš ï¸ ë„ì „ì  | ~500MB ê²½ëŸ‰í™” í•„ìš” |
| ì‹¤ì‹œê°„ ì„±ëŠ¥ | âš ï¸ ì œí•œì  | ê³ ì‚¬ì–‘ GPU í•„ìˆ˜ |

### ê¶Œì¥ êµ¬í˜„ ì „ëµ

> [!IMPORTANT]
> **Option A ì„¸ë¶€ êµ¬í˜„ ì „ëµ (ìˆ˜ì •)**
> 
> ì™„ì „í•œ ë¸Œë¼ìš°ì € ì‹¤í–‰ ëŒ€ì‹ , **í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜**ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤:

#### ì „ëµ 1: ì™„ì „ ì„œë²„ ë Œë”ë§ (ê¶Œì¥)
```
[Client] â†’ Face Params â†’ [Server (Python)] â†’ LivePortrait/PersonaLive â†’ Video Frame â†’ [Client WebRTC]
```
- **ì¥ì **: ìµœê³  í’ˆì§ˆ, ì•ˆì •ì  ì„±ëŠ¥
- **ë‹¨ì **: ì„œë²„ GPU ë¹„ìš©, ë„¤íŠ¸ì›Œí¬ ì§€ì—°

#### ì „ëµ 2: ê²½ëŸ‰ ëª¨ë¸ ë¸Œë¼ìš°ì € ì‹¤í–‰ (ì‹¤í—˜ì )
```
[Client] â†’ Face Params â†’ [WebGPU + ê²½ëŸ‰ ONNX] â†’ Avatar Frame
```
- LivePortraitì˜ ì¼ë¶€ ëª¨ë“ˆë§Œ ê²½ëŸ‰í™”í•˜ì—¬ ë¸Œë¼ìš°ì € ì‹¤í–‰
- First Order Motion Model ìˆ˜ì¤€ì˜ ê²½ëŸ‰ ëª¨ë¸ ì‚¬ìš©
- **ì¥ì **: ì„œë²„ ë¶ˆí•„ìš”, í”„ë¼ì´ë²„ì‹œ
- **ë‹¨ì **: í’ˆì§ˆ ì €í•˜, í˜¸í™˜ì„± ì œì•½

#### ì „ëµ 3: ì ì§„ì  í•˜ì´ë¸Œë¦¬ë“œ (ê· í˜•)
```
Phase 3-1: WebGPU ì¸í”„ë¼ êµ¬ì¶• + 2D ì•„ë°”íƒ€ GPU ê°€ì†
Phase 3-2: ê²½ëŸ‰ Neural í•„í„° (ìŠ¤íƒ€ì¼ ë³€í™˜)
Phase 3-3: ì„œë²„ ì˜µì…˜ ì¶”ê°€ (LivePortrait ì—°ë™)
```

### ìµœì¢… ì„ íƒ: ì „ëµ 2 - LivePortrait ë¸Œë¼ìš°ì € ê²½ëŸ‰í™”

ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ **ì „ëµ 2 (ê²½ëŸ‰ ëª¨ë¸ ë¸Œë¼ìš°ì € ì‹¤í–‰ + LivePortrait)**ë¥¼ ì±„íƒí•©ë‹ˆë‹¤.

---

## ğŸ¯ ì „ëµ 2 ìƒì„¸ êµ¬í˜„ ê³„íš

### ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Browser (Client)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Camera     â”‚â”€â”€â”€â–¶â”‚  MediaPipe   â”‚â”€â”€â”€â–¶â”‚  Face Params     â”‚   â”‚
â”‚  â”‚   Input      â”‚    â”‚  FaceMesh    â”‚    â”‚  (BlendShapes)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                    â”‚             â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                         â”‚     GPU Mode Selection              â”‚ â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚                         â”‚  â”‚ WebGPU  â”‚  â”‚ WebGL   â”‚  â”‚ CPU  â”‚â”‚ â”‚
â”‚                         â”‚  â”‚(Neural) â”‚  â”‚(Enhancedâ”‚  â”‚(2D)  â”‚â”‚ â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”˜â”‚ â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜ â”‚
â”‚                                 â–¼            â–¼           â–¼     â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                         â”‚     Avatar Renderer              â”‚   â”‚
â”‚                         â”‚  (LivePortrait-Lite / 2D Fallback)â”‚   â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                           â–¼                     â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                         â”‚     WebRTC DataChannel          â”‚   â”‚
â”‚                         â”‚   (Send Avatar Params to Peer)  â”‚   â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LivePortrait-Lite ê²½ëŸ‰í™” ì „ëµ

#### ëª¨ë¸ êµ¬ì„± ë° í¬ê¸°

| ì»´í¬ë„ŒíŠ¸ | ì›ë³¸ í¬ê¸° | ê²½ëŸ‰í™” ëª©í‘œ | ë°©ë²• |
|---------|----------|------------|------|
| Appearance Extractor | ~200MB | ~50MB | FP16 + í”„ë£¨ë‹ |
| Motion Extractor | ~150MB | ~40MB | FP16 |
| Warping Network | ~100MB | ~25MB | FP16 |
| Spade Decoder | ~300MB | ~80MB | FP16 + ë‹¤ìš´ìƒ˜í”Œ |
| **ì´í•©** | **~750MB** | **~200MB** | |

#### ìµœì í™” ê¸°ë²•

1. **FP16 ì–‘ìí™”**: ëª¨ë“  ê°€ì¤‘ì¹˜ë¥¼ FP32â†’FP16 ë³€í™˜ (50% í¬ê¸° ê°ì†Œ)
2. **í•´ìƒë„ ë‹¤ìš´ìŠ¤ì¼€ì¼**: 512x512 â†’ 256x256 (75% ì—°ì‚° ê°ì†Œ)
3. **í”„ë ˆì„ ìŠ¤í‚µ**: 30fps â†’ 15fps ì¶”ë¡  + ë³´ê°„
4. **ì ì§„ì  ë¡œë”©**: í•µì‹¬ ëª¨ë“ˆ ìš°ì„  ë¡œë“œ, ë‚˜ë¨¸ì§€ ë°±ê·¸ë¼ìš´ë“œ ë¡œë“œ

### ì˜ˆìƒ ì„±ëŠ¥

| í™˜ê²½ | GPU | ì˜ˆìƒ FPS | í’ˆì§ˆ |
|-----|-----|---------|------|
| ê³ ì‚¬ì–‘ PC | RTX 3060+ | 15-25 FPS | ì–‘í˜¸ |
| ì¤‘ì‚¬ì–‘ PC | GTX 1660 | 8-15 FPS | ë³´í†µ |
| í†µí•© GPU | Intel Iris | 3-8 FPS | ì €í’ˆì§ˆ |
| WebGPU ë¯¸ì§€ì› | - | í´ë°±â†’2D | ê¸°ë³¸ |

### ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš

#### Phase 3-1: ì¸í”„ë¼ êµ¬ì¶• (1~2ì£¼)

| í•­ëª© | íŒŒì¼ | ì„¤ëª… |
|------|------|------|
| íƒ€ì… ì •ì˜ | `avatarV3.ts` | GPU/Neural ê´€ë ¨ íƒ€ì… |
| WebGPU ê°ì§€ | `useWebGPU.ts` | GPU ì§€ì› ì—¬ë¶€ í™•ì¸ |
| GPU ëª¨ë“œ UI | `GPUModePicker.tsx` | ëª¨ë“œ ì„ íƒ ì¸í„°í˜ì´ìŠ¤ |
| ì„±ëŠ¥ ëª¨ë‹ˆí„° | `PerformanceMonitor.tsx` | FPS/ë©”ëª¨ë¦¬ í‘œì‹œ |
| í…ŒìŠ¤íŠ¸ í˜ì´ì§€ | `/test-v3/page.tsx` | Phase 3 í…ŒìŠ¤íŠ¸ í˜ì´ì§€ |

#### Phase 3-2: ëª¨ë¸ ì¤€ë¹„ (2~3ì£¼)

| í•­ëª© | ì„¤ëª… |
|------|------|
| ONNX ë³€í™˜ | LivePortrait PyTorch â†’ ONNX ë³€í™˜ |
| ì–‘ìí™” | FP16 ì–‘ìí™” ì ìš© |
| ëª¨ë¸ ë¶„ë¦¬ | í•„ìˆ˜/ì„ íƒ ëª¨ë“ˆ ë¶„ë¦¬ |
| CDN ë°°í¬ | ê²½ëŸ‰í™” ëª¨ë¸ CDN í˜¸ìŠ¤íŒ… |

#### Phase 3-3: ë¸Œë¼ìš°ì € í†µí•© (2~3ì£¼)

| í•­ëª© | íŒŒì¼ | ì„¤ëª… |
|------|------|------|
| ONNX ë¡œë” | `onnx-loader.ts` | ëª¨ë¸ ë¡œë”© ë° ìºì‹± |
| Neural í›… | `useNeuralAvatar.ts` | ONNX Runtime Web ë˜í¼ |
| Neural ë Œë”ëŸ¬ | `AvatarRendererV3.tsx` | LivePortrait í†µí•© ë Œë”ëŸ¬ |
| í´ë°± ë¡œì§ | `fallback.ts` | ì„±ëŠ¥ ì €í•˜ ì‹œ ìë™ ì „í™˜ |

#### Phase 3-4: ìµœì í™” ë° ì•ˆì •í™” (1~2ì£¼)

| í•­ëª© | ì„¤ëª… |
|------|------|
| I/O ë°”ì¸ë”© | GPU í…ì„œ ì¬ì‚¬ìš© |
| í”„ë ˆì„ ë³´ê°„ | ì €FPS ë³´ì™„ |
| ë©”ëª¨ë¦¬ ê´€ë¦¬ | ë¦¬ì†ŒìŠ¤ í•´ì œ ìµœì í™” |
| í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ | ë‹¤ì–‘í•œ ë¸Œë¼ìš°ì €/GPU í…ŒìŠ¤íŠ¸ |

### ê¸°ìˆ ì  ì œì•½ ë° ëŒ€ì‘

> [!WARNING]
> **ì•Œë ¤ì§„ ì œì•½ì‚¬í•­**
> 
> 1. **F.grid_sample 5D**: ONNX ë³€í™˜ ì‹œ ì§€ì› ì•ˆë¨ â†’ ì»¤ìŠ¤í…€ êµ¬í˜„ í•„ìš”
> 2. **WarpingNetwork ì–‘ìí™”**: ì¼ë¶€ ë ˆì´ì–´ ì–‘ìí™” ë¯¸ì§€ì› â†’ FP16 ìœ ì§€
> 3. **ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬**: 1GB ì´ìƒ í•„ìš” â†’ ì €ì‚¬ì–‘ ê¸°ê¸° í´ë°±

### í´ë°± ì „ëµ

```
WebGPU + LivePortrait-Lite (ìµœê³  í’ˆì§ˆ)
           â”‚
           â–¼ (GPU ë¯¸ì§€ì› ë˜ëŠ” ì„±ëŠ¥ ë¶€ì¡±)
WebGL + Enhanced 2D (GPU ê°€ì† í•„í„°)
           â”‚
           â–¼ (WebGL ë¯¸ì§€ì›)
Canvas 2D (ê¸°ë³¸ ì•„ë°”íƒ€)
```

### ì‚¬ìš©ì ê²½í—˜ íë¦„

1. **ì²« ì ‘ì†**: GPU ëŠ¥ë ¥ ìë™ ê°ì§€
2. **ëª¨ë¸ ë‹¤ìš´ë¡œë“œ**: í”„ë¡œê·¸ë ˆìŠ¤ ë°” í‘œì‹œ (~200MB)
3. **ì›œì—… ì¶”ë¡ **: ì²« í”„ë ˆì„ ìƒì„± (2-5ì´ˆ)
4. **ì‹¤ì‹œê°„ ë Œë”ë§**: Neural Avatar í™œì„±í™”
5. **ì„±ëŠ¥ ì €í•˜ ê°ì§€**: ìë™ í´ë°± ì œì•ˆ

### ì˜ì¡´ì„± ì¶”ê°€

```json
{
  "dependencies": {
    "onnxruntime-web": "^1.17.0"
  },
  "devDependencies": {
    "@webgpu/types": "^0.1.40"
  }
}
```

---

## ì‚¬ìš©ì ê²€í†  í•„ìš” ì‚¬í•­

> [!IMPORTANT]
> **ê¸°ìˆ  ìŠ¤íƒ ë° êµ¬í˜„ ë²”ìœ„ í™•ì¸ í•„ìš”**
> 
> Neural AvatarëŠ” ê¸°ìˆ ì ìœ¼ë¡œ ë§¤ìš° ë„ì „ì ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë‹¤ìŒ ì˜µì…˜ ì¤‘ ì„ íƒí•´ì£¼ì„¸ìš”:
> 
> **Option A: ì‹¤í—˜ì  WebGPU ê¸°ë°˜ Neural Avatar (ê³ ìœ„í—˜, ê³ ìˆ˜ìµ)**
> - ONNX Runtime Web + WebGPUë¥¼ ì‚¬ìš©í•œ ë¸Œë¼ìš°ì € ê¸°ë°˜ ì‹ ê²½ë§ ì¶”ë¡ 
> - ì‚¬ì „ í•™ìŠµëœ Face Animation ëª¨ë¸ (LivePortrait/First Order Motion ê³„ì—´) ë³€í™˜
> - ìµœì†Œ 12GB GPU, WebGPU ì§€ì› Chrome/Edge í•„ìš”
> - êµ¬í˜„ ë‚œì´ë„: â˜…â˜…â˜…â˜…â˜…
> 
> **Option B: ì„œë²„ ë Œë”ë§ Neural Avatar (ì•ˆì •ì , ì„œë²„ ë¹„ìš© ë°œìƒ)**
> - Python ë°±ì—”ë“œì—ì„œ LivePortrait ì‹¤í–‰
> - WebSocketìœ¼ë¡œ ë Œë”ë§ëœ í”„ë ˆì„ ì „ì†¡
> - ì„œë²„ GPU í•„ìš” (RTX 3060 ì´ìƒ)
> - êµ¬í˜„ ë‚œì´ë„: â˜…â˜…â˜…â˜†â˜†
> 
> **Option C: ì ì§„ì  2Dâ†’Neural ì „í™˜ (ê¶Œì¥, ì‹¤ìš©ì )**
> - Phase 3-1: WebGPU í™œì„±í™” ë° ì„±ëŠ¥ ì¸¡ì • ì¸í”„ë¼ êµ¬ì¶•
> - Phase 3-2: ê³ ê¸‰ 2D í•„í„° (ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ë³€í™˜) ì ìš©
> - Phase 3-3: í–¥í›„ Neural Avatar ëª¨ë¸ í†µí•© ì¤€ë¹„
> - êµ¬í˜„ ë‚œì´ë„: â˜…â˜…â˜…â˜†â˜†

> [!WARNING]
> **ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì œì•½**
> - WebGPUëŠ” í˜„ì¬ Chrome 113+, Edge 113+ ì—ì„œ ì§€ì›
> - Safari, FirefoxëŠ” ì‹¤í—˜ì  í”Œë˜ê·¸ í•„ìš”
> - ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì§€ì› ì œí•œì 
> - GPU ë©”ëª¨ë¦¬ ìµœì†Œ 4GB ê¶Œì¥

---

## ì œì•ˆ ë³€ê²½ ì‚¬í•­ (Option C ê¸°ì¤€)

### ğŸ“ ë””ë ‰í„°ë¦¬ êµ¬ì¡° (Phase 3 ì¶”ê°€)

```
VirtualPersona/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx              # í™ˆ (ì•„ë°”íƒ€ ì„ íƒ) - Phase 1
â”‚   â”œâ”€â”€ room/[roomId]/        # í†µí™” ë£¸ - Phase 1
â”‚   â”œâ”€â”€ home-v2/              # í™ˆ - Phase 2
â”‚   â”œâ”€â”€ room-v2/[roomId]/     # í†µí™” ë£¸ - Phase 2
â”‚   â”œâ”€â”€ test-v2/              # í…ŒìŠ¤íŠ¸ - Phase 2
â”‚   â”œâ”€â”€ home-v3/              # [NEW] í™ˆ - Phase 3
â”‚   â”œâ”€â”€ room-v3/[roomId]/     # [NEW] í†µí™” ë£¸ - Phase 3
â”‚   â””â”€â”€ test-v3/              # [NEW] í…ŒìŠ¤íŠ¸ - Phase 3
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AvatarRenderer.tsx    # ê¸°ë³¸ ë Œë”ëŸ¬ - Phase 1
â”‚   â”œâ”€â”€ AvatarRendererV2.tsx  # í™•ì¥ ë Œë”ëŸ¬ - Phase 2
â”‚   â”œâ”€â”€ AvatarRendererV3.tsx  # [NEW] Neural ë Œë”ëŸ¬ - Phase 3
â”‚   â”œâ”€â”€ GPUModePicker.tsx     # [NEW] GPU ëª¨ë“œ ì„ íƒ UI - Phase 3
â”‚   â””â”€â”€ PerformanceMonitor.tsx # [NEW] ì„±ëŠ¥ ëª¨ë‹ˆí„° - Phase 3
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useFaceTracking.ts    # ì–¼êµ´ ì¶”ì  - Phase 1
â”‚   â”œâ”€â”€ useHandTracking.ts    # ì† ì¶”ì  - Phase 2
â”‚   â”œâ”€â”€ useWebRTC.ts          # P2P í†µì‹  - Phase 1
â”‚   â”œâ”€â”€ useWebGPU.ts          # [NEW] WebGPU ê°ì§€ ë° ì´ˆê¸°í™” - Phase 3
â”‚   â””â”€â”€ useNeuralAvatar.ts    # [NEW] Neural ë Œë”ë§ í›… - Phase 3
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ gpu/                   # [NEW] GPU ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ webgpu-utils.ts   # WebGPU ì´ˆê¸°í™” ë° ì²´í¬
â”‚       â”œâ”€â”€ onnx-loader.ts    # ONNX ëª¨ë¸ ë¡œë”
â”‚       â””â”€â”€ fallback.ts       # í´ë°± ë¡œì§
â””â”€â”€ types/
    â”œâ”€â”€ avatar.ts             # ê¸°ë³¸ íƒ€ì… - Phase 1
    â”œâ”€â”€ avatarV2.ts           # í™•ì¥ íƒ€ì… - Phase 2
    â””â”€â”€ avatarV3.ts           # [NEW] Neural íƒ€ì… - Phase 3
```

---

### Component: íƒ€ì… í™•ì¥

#### [NEW] avatarV3.ts

Phase 3 ì „ìš© íƒ€ì… ì •ì˜:
- `GPUMode`: `'auto' | 'webgpu' | 'webgl' | 'cpu'`
- `NeuralAvatarConfig`: Neural Avatar ì„¤ì •
- `PerformanceMetrics`: ì„±ëŠ¥ ì¸¡ì • ë°ì´í„°
- `RenderQuality`: `'low' | 'medium' | 'high' | 'ultra'`

---

### Component: WebGPU ê°ì§€ ë° ì´ˆê¸°í™”

#### [NEW] useWebGPU.ts

ê¸°ëŠ¥:
- WebGPU ì§€ì› ì—¬ë¶€ ê°ì§€
- GPU ì–´ëŒ‘í„° ë° ë””ë°”ì´ìŠ¤ ì´ˆê¸°í™”
- ì‚¬ìš© ê°€ëŠ¥í•œ GPU ê¸°ëŠ¥ í™•ì¸
- í´ë°± ëª¨ë“œ ìë™ ì „í™˜

```typescript
interface WebGPUStatus {
  isSupported: boolean;
  gpuInfo: GPUAdapterInfo | null;
  fallbackMode: 'webgl' | 'cpu' | null;
  error: string | null;
}
```

---

### Component: GPU ëª¨ë“œ ì„ íƒ UI

#### [NEW] GPUModePicker.tsx

ê¸°ëŠ¥:
- GPU ëª¨ë“œ ì„ íƒ (ìë™/WebGPU/WebGL/CPU)
- í˜„ì¬ GPU ìƒíƒœ í‘œì‹œ
- ì„±ëŠ¥ vs í’ˆì§ˆ íŠ¸ë ˆì´ë“œì˜¤í”„ ì„¤ëª…
- ì§€ì›ë˜ì§€ ì•ŠëŠ” ëª¨ë“œ ë¹„í™œì„±í™”

---

### Component: ì„±ëŠ¥ ëª¨ë‹ˆí„°

#### [NEW] PerformanceMonitor.tsx

ê¸°ëŠ¥:
- ì‹¤ì‹œê°„ FPS í‘œì‹œ
- GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (ê°€ëŠ¥í•œ ê²½ìš°)
- ë Œë”ë§ ì§€ì—° ì‹œê°„
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œê°„
- ê²½ê³  í‘œì‹œ (ì„±ëŠ¥ ì €í•˜ ì‹œ)

---

### Component: Neural ì•„ë°”íƒ€ ë Œë”ëŸ¬

#### [NEW] AvatarRendererV3.tsx

ê¸°ëŠ¥:
- Phase 2 `AvatarRendererV2` ê¸°ëŠ¥ ìƒì†
- WebGPU ê¸°ë°˜ ê³ ê¸‰ ë Œë”ë§ íŒŒì´í”„ë¼ì¸
- ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ë³€í™˜ (ë§Œí™”/ìˆ˜ì±„í™”/í”½ì…€ì•„íŠ¸)
- GPU ê°€ì† ë¸”ë Œë“œì‰ì´í”„ ì²˜ë¦¬
- ì„±ëŠ¥ fallback (WebGL â†’ 2D Canvas)

---

### Component: Neural ë Œë”ë§ í›…

#### [NEW] useNeuralAvatar.ts

ê¸°ëŠ¥:
- ONNX Runtime Web ì´ˆê¸°í™”
- Neural ëª¨ë¸ ë¡œë”© (ë¹„ë™ê¸°)
- Face Parameter â†’ Neural Output ë³€í™˜
- ë Œë”ë§ í’ˆì§ˆ ë™ì  ì¡°ì ˆ

---

## ê²€ì¦ ê³„íš

### ìë™í™” í…ŒìŠ¤íŠ¸

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev:all

# Phase 1 í…ŒìŠ¤íŠ¸: http://localhost:3000/test
# Phase 2 í…ŒìŠ¤íŠ¸: http://localhost:3000/test-v2
# Phase 3 í…ŒìŠ¤íŠ¸: http://localhost:3000/test-v3 (ìƒˆ í˜ì´ì§€)
```

### ìˆ˜ë™ ê²€ì¦

1. **WebGPU ê°ì§€ í…ŒìŠ¤íŠ¸**
   - WebGPU ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œ GPU ì–´ëŒ‘í„° ì •ë³´ í‘œì‹œ í™•ì¸
   - ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œ í´ë°± ëª¨ë“œ ìë™ ì „í™˜ í™•ì¸

2. **GPU ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸**
   - ê° ëª¨ë“œ(WebGPU/WebGL/CPU)ì—ì„œ ì•„ë°”íƒ€ ë Œë”ë§ ì •ìƒ ë™ì‘
   - ëª¨ë“œ ì „í™˜ ì‹œ ëŠê¹€ ì—†ì´ ë Œë”ë§ ìœ ì§€

3. **ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸**
   - FPS ì¸¡ì •ê°’ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
   - ì„±ëŠ¥ ì €í•˜ ì‹œ ê²½ê³  í‘œì‹œ

4. **Phase 1/2 í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸**
   - Phase 3 ì½”ë“œ ì¶”ê°€ í›„ Phase 1/2 ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ
   - ê¸°ì¡´ `/test`, `/test-v2` í˜ì´ì§€ ì •ìƒ ë™ì‘

---

## êµ¬í˜„ ìˆœì„œ (ì œì•ˆ)

### Phase 3-1: ì¸í”„ë¼ êµ¬ì¶• (1ì°¨ ëª©í‘œ)
1. **íƒ€ì… í™•ì¥** (`avatarV3.ts`)
2. **WebGPU ê°ì§€** (`useWebGPU.ts`, `webgpu-utils.ts`)
3. **GPU ëª¨ë“œ ì„ íƒ** (`GPUModePicker.tsx`)
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°** (`PerformanceMonitor.tsx`)
5. **í…ŒìŠ¤íŠ¸ í˜ì´ì§€ V3** (`/test-v3`)

### Phase 3-2: ê³ ê¸‰ ë Œë”ë§ (2ì°¨ ëª©í‘œ)
6. **GPU ê°€ì† í•„í„°** (ë¸”ëŸ¬, ìƒ¤í”„ë‹ ë“±)
7. **ìŠ¤íƒ€ì¼ ë³€í™˜** (ë§Œí™”í’, ìˆ˜ì±„í™”í’)
8. **ë™ì  í’ˆì§ˆ ì¡°ì ˆ**

### Phase 3-3: Neural Avatar (ì¥ê¸° ëª©í‘œ)
9. **ONNX ëª¨ë¸ ë¡œë”** (`onnx-loader.ts`)
10. **Neural ë Œë”ëŸ¬** (`AvatarRendererV3.tsx`)
11. **Neural í›…** (`useNeuralAvatar.ts`)

---

## ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### WebGPU í˜¸í™˜ì„±

| ë¸Œë¼ìš°ì € | ì§€ì› ìƒíƒœ | ë¹„ê³  |
|---------|---------|------|
| Chrome 113+ | âœ… ì™„ì „ ì§€ì› | ê¶Œì¥ ë¸Œë¼ìš°ì € |
| Edge 113+ | âœ… ì™„ì „ ì§€ì› | Chromium ê¸°ë°˜ |
| Firefox 120+ | âš ï¸ í”Œë˜ê·¸ í•„ìš” | `dom.webgpu.enabled` |
| Safari 17+ | âš ï¸ ì‹¤í—˜ì  | Technology Preview |
| ëª¨ë°”ì¼ Chrome | âŒ ë¯¸ì§€ì› | í–¥í›„ ì§€ì› ì˜ˆì • |

### ì„±ëŠ¥ í´ë°± ì „ëµ

```
WebGPU (ê³ ì„±ëŠ¥) â†’ WebGL (ì¤‘ê°„) â†’ 2D Canvas (ì €ì„±ëŠ¥/í˜¸í™˜ì„±)
     â†“                â†“                â†“
 Neural Avatar   Enhanced 2D      Basic 2D
```

### ì˜ì¡´ì„± ì¶”ê°€ ì˜ˆì •

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | ë²„ì „ | ìš©ë„ |
|-----------|------|------|
| onnxruntime-web | ^1.17.0 | Neural ëª¨ë¸ ì¶”ë¡  |
| @webgpu/types | ^0.1.40 | WebGPU TypeScript íƒ€ì… |

---

## ë‹¤ìŒ ë‹¨ê³„

ì‚¬ìš©ì ì„ íƒì— ë”°ë¼ êµ¬í˜„ì„ ì§„í–‰í•©ë‹ˆë‹¤:
1. Option A/B/C ì¤‘ ì„ íƒ í™•ì¸
2. ì„ íƒëœ ì˜µì…˜ì— ë”°ë¥¸ ìƒì„¸ êµ¬í˜„

**ê¶Œì¥ ì‚¬í•­**: Option C (ì ì§„ì  ì „í™˜)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€:
- í˜„ì¬ ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì œì•½ì„ ê³ ë ¤í•œ ì‹¤ìš©ì  ì ‘ê·¼
- ë‹¨ê³„ë³„ ê²€ì¦ ê°€ëŠ¥
- ê¸°ì¡´ ê¸°ëŠ¥ê³¼ì˜ ì•ˆì •ì  ê³µì¡´
- í–¥í›„ Neural Avatar í†µí•©ì„ ìœ„í•œ ê¸°ë°˜ ë§ˆë ¨
