
# 실시간 아바타 기반 1:1 화상채팅 서비스

## 1. 프로젝트 개요

본 프로젝트는 사용자가 실제 얼굴 대신 **실시간으로 동작하는 아바타**를 통해 1:1 화상채팅을 진행할 수 있는 커뮤니케이션 서비스를 구축하는 것을 목표로 한다.  
모든 고비용 연산은 **클라이언트 로컬**에서 처리하며, 서버는 최소한의 시그널링 및 세션 제어만 담당한다.

핵심 철학은 다음과 같다.

> 영상이 아닌 의미를 전달하고,  
> 서버가 아닌 사용자 단에서 존재를 렌더링한다.

---

## 2. 목표 및 범위

### 2.1 목표
- 실시간 아바타 기반 1:1 통신
- 저지연 (<120ms) 상호작용
- 개인정보 보호 (영상 미전송 구조)
- 확장 가능한 아바타 파이프라인

### 2.2 범위
- Web 기반 MVP 우선
- 2D Live Avatar → 3D Avatar → Neural Avatar 순차 확장
- 모바일은 후순위

---

## 3. 사용자 시나리오

1. 사용자가 서비스 접속
2. 아바타 선택 (사전 정의 이미지)
3. 상대방과 1:1 세션 생성
4. 카메라는 로컬 추적에만 사용
5. 상대방 화면에는 선택된 아바타가 실시간으로 표시됨
6. 표정, 고개, 눈깜빡임 등이 실시간 반영

---

## 4. 시스템 아키텍처

### 4.1 전체 구조

- Client A
  - 카메라 입력
  - 얼굴/포즈 추적
  - 아바타 로컬 렌더링
  - 파라미터 전송

- Client B
  - 동일 구조

- Signaling Server
  - WebRTC offer/answer
  - ICE 교환
  - 룸 관리
  - 아바타 메타데이터 전달

---

## 5. 클라이언트 기술 스펙

### 5.1 입력 추적

| 기능 | 기술 |
|---|---|
| 얼굴 랜드마크 | MediaPipe FaceMesh |
| 표정 계수 | BlendShape 기반 |
| 고개 회전 | Head Pose Estimation |
| 손/상체 (확장) | MediaPipe Hands / Pose |

### 5.2 아바타 표현 (MVP)

- 2D Live Avatar
- 레이어 구조 (눈, 입, 얼굴, 고개)
- Canvas 또는 WebGL 렌더링
- 30~60 FPS 유지

### 5.3 아바타 파라미터 모델

```json
{
  "headRotation": [0.1, -0.05, 0.0],
  "eyeBlinkLeft": 0.32,
  "eyeBlinkRight": 0.30,
  "mouthOpen": 0.61,
  "smile": 0.44,
  "timestamp": 123456789
}
```

---

## 6. 네트워크 및 통신

### 6.1 통신 방식

- WebRTC 사용
- VideoTrack: 사용하지 않음 (MVP 기준)
- DataChannel:
  - 표정/포즈 파라미터 전송
  - 20~30Hz 전송

### 6.2 서버 역할

- 시그널링 전용
- GPU 불필요
- 상태 비저장 (stateless)

---

## 7. 서버 기술 스펙

- Node.js 또는 Go
- WebSocket 기반 signaling
- coturn (STUN/TURN)

---

## 8. 성능 요구사항

| 항목 | 목표 |
|---|---|
| End-to-End Latency | < 120ms |
| Face Tracking FPS | ≥ 30 |
| Avatar Render FPS | ≥ 60 |
| Data Payload | < 5KB / frame |

---

## 9. 보안 및 프라이버시

- 원본 영상 외부 전송 없음
- 얼굴 데이터 서버 저장 금지
- 세션 종료 시 모든 상태 폐기

---

## 10. 단계별 개발 로드맵

### Phase 1 – MVP
- WebRTC 1:1 연결
- 얼굴 추적
- 2D 아바타 렌더
- 파라미터 전송

### Phase 2 – 고도화
- 손/상체 추가
- 감정 프리셋
- 아바타 커스터마이징

### Phase 3 – Neural Avatar
- GPU 선택 모드
- PersonaLive / LivePortrait 계열 통합
- 성능 fallback 구조

---

## 11. 성공 기준 (KPI)

- 5분 이상 안정적 통화 성공률 99%
- 평균 지연 < 120ms
- 사용자 카메라 ON 상태에서도 CPU 사용률 60% 이하

---

## 12. 비전

이 시스템은 화상채팅이 아니라  
**존재를 대체하는 인터페이스**다.

얼굴을 보내지 않고,  
의미와 감정을 보낸다.
